% CIV102 Bridge Design Project
clear; close all;
% Step 0: Initialize Parameters
L = 1200;   % Length of the bridge
n = 1200;   % Discretize into 1 mm segments
P = 400;    % Total weight of the train [N]
x = linspace(0, L, n+1);    % x-axis
% Step 1: SFD, BMD Under Train Loading
x_train = [52, 228, 392, 568, 732, 908]; % train load locations
P_train = [1 1 1 1 1 1] * P/6;

n_train = 45;    % number of train locations
SFDi = zeros(n_train, n+1);     % 1 SFD for each train location
BMDi = zeros(n_train, n+1);     % 1 BMD for each train location

for i = 1:n_train
    % start location of train
    x_start_location = 10 * i;
    x_train_adjusted = x_train + x_start_location;

    % sum of moments at A eqn
    R_y = (sum(P_train .* x_train_adjusted)) / L;
    % sum of Fy eqn
    L_y = sum(P_train) - R_y;
    w = L_y;
    SFDi(i, 1) = w;
    w = w - P/6;
    SFDi(i, 2:x_train_adjusted(1)) = w;
    w = w - P/6;
    SFDi(i, x_train_adjusted(1):x_train_adjusted(2)) = w;
    w = w - P/6;
    SFDi(i, x_train_adjusted(2):x_train_adjusted(3)) = w;
    w = w - P/6;
    SFDi(i, x_train_adjusted(3):x_train_adjusted(4)) = w;
    w = w - P/6;
    SFDi(i, x_train_adjusted(4):x_train_adjusted(5)) = w;
    w = w - P/6;
    SFDi(i, x_train_adjusted(5):n) = w;
    w = w + R_y;
    SFDi(i, n+1) = w;
    BMDi(i,:) = cumtrapz(SFDi(i, :));
end

SFD = max(abs(SFDi));
BMD = max(BMDi);

figure(1);
hold on
plot(x, SFDi, 'k')
plot(x, SFD, "r")
xlabel('Distance Along Bridge (mm)')
ylabel('Shear Force (N)')
hold off

figure(2)
hold on
plot(x, BMDi, "k")
plot(x, BMD, "r")
xlabel('Distance Along Bridge (mm)')
ylabel('Bending Moment (N m)')
hold off

